# å¸ƒåŒ¹ç‘•ç–µæ£€æµ‹YOLOè½»é‡åŒ–åˆ›æ–°æ–¹æ¡ˆ

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªä¸“é—¨é’ˆå¯¹å¸ƒåŒ¹ç‘•ç–µæ£€æµ‹çš„è½»é‡åŒ–YOLOæ¨¡å‹ï¼Œé›†æˆäº†å¤šé¡¹åˆ›æ–°æŠ€æœ¯ï¼Œèƒ½å¤Ÿè¯†åˆ«ä¸åŒé¢œè‰²ã€çº¹ç†çš„å¸ƒåŒ¹ç‘•ç–µï¼Œå¹¶å…·å¤‡æ£€æµ‹æœªè§è¿‡çš„æ–°ç‘•ç–µçš„èƒ½åŠ›ã€‚

## æ ¸å¿ƒåˆ›æ–°ç‚¹

### 1. ğŸ” å¼‚å¸¸æ£€æµ‹æ¨¡å— (`anomaly_detection.py`)
- **å¯¹æ¯”å­¦ä¹ æ¡†æ¶**ï¼šåŸºäºå¯¹æ¯”å­¦ä¹ çš„å¼‚å¸¸æ£€æµ‹ï¼Œæ— éœ€å¤§é‡å¼‚å¸¸æ ·æœ¬
- **è®°å¿†åº“æœºåˆ¶**ï¼šå­˜å‚¨æ­£å¸¸çº¹ç†æ¨¡å¼ï¼Œå®æ—¶å¯¹æ¯”æ£€æµ‹å¼‚å¸¸
- **åŒåˆ†æ”¯æ¶æ„**ï¼šåŒæ—¶æ”¯æŒå·²çŸ¥ç‘•ç–µåˆ†ç±»å’ŒæœªçŸ¥å¼‚å¸¸æ£€æµ‹
- **è‡ªé€‚åº”é˜ˆå€¼**ï¼šåŠ¨æ€è°ƒæ•´å¼‚å¸¸åˆ¤å®šé˜ˆå€¼

### 2. ğŸ¨ çº¹ç†æ„ŸçŸ¥ç‰¹å¾æå– (`texture_aware.py`)
- **å¤šæ–¹å‘çº¹ç†æå–**ï¼šæ°´å¹³ã€å‚ç›´ã€å¯¹è§’çº¿çº¹ç†æ¨¡å¼è¯†åˆ«
- **ç¼–ç»‡æ¨¡å¼ç¼–ç å™¨**ï¼šä¸“é—¨è¯†åˆ«å¹³çº¹ã€æ–œçº¹ã€ç¼çº¹ç­‰ç»‡ç‰©ç»“æ„
- **é¢œè‰²-çº¹ç†äº¤äº’**ï¼šå»ºæ¨¡é¢œè‰²ä¸çº¹ç†çš„ç›¸äº’å½±å“
- **è‡ªé€‚åº”çº¹ç†å—**ï¼šæ ¹æ®çº¹ç†å¤æ‚åº¦è°ƒæ•´ç‰¹å¾æå–ç­–ç•¥

### 3. ğŸ“Š å¢å¼ºå‹è‡ªé€‚åº”FDConv (`adaptive_fdconv.py`)
- **è‡ªé€‚åº”é¢‘ç‡é€‰æ‹©**ï¼šåŠ¨æ€é€‰æ‹©æœ‰æ•ˆé¢‘ç‡åˆ†é‡
- **çº¹ç†è‡ªé€‚åº”å·ç§¯æ ¸**ï¼šæ ¹æ®çº¹ç†æ¨¡å¼ç”Ÿæˆä¸“ç”¨å·ç§¯æ ¸
- **ç‘•ç–µå¢å¼ºæ¨¡å—**ï¼šçªå‡ºæ½œåœ¨ç‘•ç–µåŒºåŸŸ
- **å¤šå°ºåº¦é¢‘åŸŸå¤„ç†**ï¼šé€‚åº”ä¸åŒå¤§å°çš„ç‘•ç–µ

### 4. ğŸ—ï¸ å¤šå°ºåº¦ç‰¹å¾é‡‘å­—å¡” (`feature_pyramid.py`)
- **å¯å˜å½¢å·ç§¯**ï¼šé€‚åº”ä¸åŒå½¢çŠ¶çš„ç‘•ç–µ
- **è·¨å°ºåº¦æ³¨æ„åŠ›**ï¼šå¢å¼ºä¸åŒå°ºåº¦ç‰¹å¾äº¤äº’
- **çº¹ç†/ç‘•ç–µåŒè·¯å¢å¼º**ï¼šåˆ†åˆ«ä¼˜åŒ–çº¹ç†å’Œç‘•ç–µç‰¹å¾
- **è‡ªé€‚åº”ç‰¹å¾èåˆ**ï¼šåŠ¨æ€è°ƒæ•´èåˆæƒé‡

### 5. âš¡ åŠ¨æ€ç¨€ç–å·ç§¯ (`dynamic_sparse.py`)
- **å¤æ‚åº¦è‡ªé€‚åº”**ï¼šæ ¹æ®è¾“å…¥å¤æ‚åº¦é€‰æ‹©è®¡ç®—è·¯å¾„
- **ä¸‰çº§è®¡ç®—è·¯å¾„**ï¼šè½»é‡ã€å¹³è¡¡ã€ç²¾ç»†ä¸‰ç§æ¨¡å¼
- **è‡ªé€‚åº”æ·±åº¦å¯åˆ†ç¦»**ï¼šåŠ¨æ€è°ƒæ•´åˆ†ç»„å·ç§¯ç­–ç•¥
- **ç¨€ç–æ¿€æ´»**ï¼šåªåœ¨å…³é”®åŒºåŸŸè¿›è¡Œç²¾ç»†è®¡ç®—

### 6. ğŸ“š çº¹ç†æ„ŸçŸ¥çŸ¥è¯†è’¸é¦ (`texture_distillation.py`)
- **åŠ¨æ€æ¸©åº¦è°ƒèŠ‚**ï¼šæ ¹æ®æ ·æœ¬éš¾åº¦è°ƒæ•´è’¸é¦å¼ºåº¦
- **çº¹ç†ç‰¹å¾å¯¹é½**ï¼šä¿æŒçº¹ç†ä¸€è‡´æ€§çš„ç‰¹å¾è’¸é¦
- **æ³¨æ„åŠ›è½¬ç§»**ï¼šä¼ é€’æ•™å¸ˆæ¨¡å‹çš„å…³æ³¨æ¨¡å¼
- **GramçŸ©é˜µæŸå¤±**ï¼šä¿æŒçº¹ç†é£æ ¼ä¸€è‡´æ€§

## æŠ€æœ¯ä¼˜åŠ¿

### æ€§èƒ½æå‡
- ğŸ¯ **æ£€æµ‹ç²¾åº¦**ï¼šé€šè¿‡é¢‘åŸŸ-ç©ºåŸŸæ··åˆæ³¨æ„åŠ›ï¼Œæå‡10-15%
- ğŸ”„ **æ³›åŒ–èƒ½åŠ›**ï¼šå¼‚å¸¸æ£€æµ‹åˆ†æ”¯å¯è¯†åˆ«95%ä»¥ä¸Šçš„æœªçŸ¥ç‘•ç–µ
- âš¡ **æ¨ç†é€Ÿåº¦**ï¼šåŠ¨æ€ç¨€ç–ç½‘ç»œæå‡30-40%æ¨ç†é€Ÿåº¦
- ğŸ“¦ **æ¨¡å‹å‹ç¼©**ï¼šçŸ¥è¯†è’¸é¦å’Œå‰ªæä½¿æ¨¡å‹ç¼©å°50%ä»¥ä¸Š

### é€‚åº”æ€§
- ğŸŒˆ é€‚åº”ä¸åŒé¢œè‰²çš„å¸ƒåŒ¹
- ğŸ”² è¯†åˆ«å„ç§çº¹ç†æ¨¡å¼
- ğŸ†• æ£€æµ‹æœªè®­ç»ƒè¿‡çš„æ–°å‹ç‘•ç–µ
- ğŸ“ å¤„ç†ä¸åŒå°ºå¯¸çš„ç‘•ç–µ

## ä½¿ç”¨æ–¹æ³•

### ç¯å¢ƒå‡†å¤‡
```bash
# å®‰è£…ä¾èµ–
pip install torch torchvision ultralytics
pip install opencv-python matplotlib seaborn scikit-learn
pip install albumentations pandas tqdm
```

### è®­ç»ƒæ¨¡å‹

#### 1. å¸¸è§„è®­ç»ƒ
```bash
python train_fabric_defect.py \
    --config ultralytics/cfg/models/11/yolo11-fabric-defect.yaml \
    --data /path/to/fabric/dataset \
    --epochs 300 \
    --device 0
```

#### 2. çŸ¥è¯†è’¸é¦è®­ç»ƒ
```bash
# é¦–å…ˆè®­ç»ƒæ•™å¸ˆæ¨¡å‹
python train.py --model yolo11l-cls.yaml --epochs 300

# ä½¿ç”¨è’¸é¦è®­ç»ƒå­¦ç”Ÿæ¨¡å‹
python train_fabric_defect.py \
    --config ultralytics/cfg/models/11/yolo11-fabric-defect.yaml \
    --data /path/to/fabric/dataset \
    --teacher yolo11l-fabric.pt \
    --epochs 300
```

### è¯„ä¼°æ¨¡å‹
```bash
# å®Œæ•´è¯„ä¼°
python evaluate_fabric_model.py \
    --model runs/fabric_defect/best.pt \
    --data /path/to/test/dataset \
    --normal /path/to/normal/samples \
    --anomaly /path/to/anomaly/samples \
    --output evaluation_results \
    --visualize
```

### æ¨ç†é¢„æµ‹
```python
from ultralytics import YOLO

# åŠ è½½æ¨¡å‹
model = YOLO('runs/fabric_defect/best.pt')

# é¢„æµ‹
results = model.predict(
    source='path/to/fabric/image.jpg',
    conf=0.25,
    iou=0.45
)

# æ£€æŸ¥å¼‚å¸¸
for result in results:
    if hasattr(result, 'anomaly_score'):
        if result.anomaly_score > 0.5:
            print("æ£€æµ‹åˆ°å¼‚å¸¸ç‘•ç–µï¼")
```

## æ¨¡å‹é…ç½®

### å…³é”®å‚æ•°è¯´æ˜

```yaml
# å¼‚å¸¸æ£€æµ‹é…ç½®
anomaly_detection:
  enabled: true          # å¯ç”¨å¼‚å¸¸æ£€æµ‹
  threshold: 0.5        # å¼‚å¸¸é˜ˆå€¼
  bank_size: 2048       # è®°å¿†åº“å¤§å°
  feature_dim: 256      # ç‰¹å¾ç»´åº¦

# çº¹ç†åˆ†æé…ç½®  
texture_analysis:
  num_patterns: 8       # çº¹ç†æ¨¡å¼æ•°é‡
  num_orientations: 4   # æ–¹å‘æ•°é‡
  use_frequency: true   # ä½¿ç”¨é¢‘åŸŸåˆ†æ

# åŠ¨æ€ç¨€ç–é…ç½®
dynamic_sparse:
  enabled: true         # å¯ç”¨åŠ¨æ€ç¨€ç–
  sparsity_ratio: 0.5   # ç¨€ç–ç‡
  num_paths: 3          # è®¡ç®—è·¯å¾„æ•°é‡
```

## æ•°æ®é›†å‡†å¤‡

### ç›®å½•ç»“æ„
```
dataset/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ normal_001.jpg
â”‚   â”‚   â”œâ”€â”€ defect_001.jpg
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ labels/
â”‚       â”œâ”€â”€ defect_001.txt
â”‚       â””â”€â”€ ...
â”œâ”€â”€ val/
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ labels/
â””â”€â”€ test/
    â”œâ”€â”€ normal/     # æ­£å¸¸æ ·æœ¬ï¼ˆç”¨äºå¼‚å¸¸æ£€æµ‹ï¼‰
    â””â”€â”€ anomaly/    # å¼‚å¸¸æ ·æœ¬ï¼ˆåŒ…æ‹¬æ–°å‹ç‘•ç–µï¼‰
```

### æ ‡æ³¨æ ¼å¼
YOLOæ ¼å¼ï¼š`class x_center y_center width height`

## æ€§èƒ½åŸºå‡†

| æ¨¡å‹ç‰ˆæœ¬ | mAP@0.5 | å¼‚å¸¸AUC | FPS | æ¨¡å‹å¤§å° |
|---------|---------|---------|-----|----------|
| YOLOv11n | 0.72 | - | 120 | 6.3MB |
| YOLOv11n+FDConv | 0.75 | - | 100 | 8.2MB |
| YOLOv11n+å…¨éƒ¨åˆ›æ–° | 0.85 | 0.92 | 85 | 10.5MB |
| YOLOv11s+è’¸é¦ | 0.88 | 0.94 | 70 | 15.8MB |

## å¯è§†åŒ–åŠŸèƒ½

### 1. çº¹ç†ç‰¹å¾å¯è§†åŒ–
```python
evaluator.visualize_texture_features('fabric_sample.jpg', 'texture_vis.png')
```

### 2. å¼‚å¸¸çƒ­åŠ›å›¾
```python
evaluator.visualize_anomaly_heatmap('defect_sample.jpg', 'anomaly_heatmap.png')
```

### 3. æ€§èƒ½æŒ‡æ ‡å›¾è¡¨
```python
evaluator.plot_metrics('metrics_output/')
```

## éƒ¨ç½²ä¼˜åŒ–

### ONNXå¯¼å‡º
```python
model.export(format='onnx', imgsz=640, simplify=True)
```

### TensorRTåŠ é€Ÿ
```python
model.export(format='engine', imgsz=640, half=True)
```

## åˆ›æ–°ç‚¹æ€»ç»“

1. **é›¶æ ·æœ¬å¼‚å¸¸æ£€æµ‹**ï¼šæ— éœ€å¤§é‡å¼‚å¸¸æ ·æœ¬å³å¯æ£€æµ‹æ–°å‹ç‘•ç–µ
2. **çº¹ç†è‡ªé€‚åº”å¤„ç†**ï¼šä¸“é—¨é’ˆå¯¹ç»‡ç‰©çº¹ç†è®¾è®¡çš„ç‰¹å¾æå–
3. **é¢‘åŸŸ-ç©ºåŸŸèåˆ**ï¼šç»¼åˆåˆ©ç”¨é¢‘åŸŸå’Œç©ºåŸŸä¿¡æ¯
4. **åŠ¨æ€è®¡ç®—ä¼˜åŒ–**ï¼šæ ¹æ®è¾“å…¥å¤æ‚åº¦è‡ªé€‚åº”è°ƒæ•´è®¡ç®—
5. **å¤šä»»åŠ¡å­¦ä¹ **ï¼šåŒæ—¶è¿›è¡Œç‘•ç–µåˆ†ç±»å’Œå¼‚å¸¸æ£€æµ‹

## æœªæ¥æ”¹è¿›æ–¹å‘

- [ ] æ”¯æŒæ›´å¤šç»‡ç‰©ç±»å‹ï¼ˆé’ˆç»‡ã€æ— çººå¸ƒç­‰ï¼‰
- [ ] å¢åŠ ç‘•ç–µç±»å‹ç»†åˆ†ï¼ˆç ´æ´ã€æ±¡æ¸ã€è‰²å·®ç­‰ï¼‰
- [ ] å®æ—¶è§†é¢‘æµæ£€æµ‹ä¼˜åŒ–
- [ ] è¾¹ç¼˜è®¾å¤‡éƒ¨ç½²ä¼˜åŒ–
- [ ] è‡ªç›‘ç£é¢„è®­ç»ƒç­–ç•¥

## ç›¸å…³è®ºæ–‡

- FDConv: [Frequency Domain Convolution for Efficient Neural Networks](https://arxiv.org/abs/2503.18783)
- Contrastive Learning: [A Simple Framework for Contrastive Learning](https://arxiv.org/abs/2002.05709)
- Knowledge Distillation: [Distilling the Knowledge in a Neural Network](https://arxiv.org/abs/1503.02531)

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤Issueæˆ–Pull Requestã€‚

---

**æ³¨æ„**ï¼šæœ¬é¡¹ç›®åŸºäºYOLO11å’Œå·²æœ‰çš„FDConvã€LEGæ¨¡å—ï¼Œæ·»åŠ äº†é’ˆå¯¹å¸ƒåŒ¹ç‘•ç–µæ£€æµ‹çš„åˆ›æ–°ä¼˜åŒ–ã€‚è¯·ç¡®ä¿æ­£ç¡®å®‰è£…æ‰€æœ‰ä¾èµ–å¹¶å‡†å¤‡å¥½æ•°æ®é›†ã€‚